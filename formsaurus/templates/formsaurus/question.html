{% extends "formsaurus/skeleton.html" %}
{% load static %}

{% block content %}
    {% if question.type == 'WS' %}
        {% include 'formsaurus/templates/welcome_screen.html' %}
    {% elif question.type == 'MC' %}
        {% include 'formsaurus/templates/multiple_choice.html' %}
    {% elif question.type == 'TS' %}
        {% include 'formsaurus/templates/thank_you_screen.html' %}
    {% elif question.type == 'PN' %}
        {% include 'formsaurus/templates/phone_number.html' %}
    {% elif question.type == 'ST' %}
        {% include 'formsaurus/templates/short_text.html' %}
    {% elif question.type == 'LT' %}
        {% include 'formsaurus/templates/long_text.html' %}
    {% elif question.type == 'S_' %}
        {% include 'formsaurus/templates/statement.html' %}
    {% elif question.type == 'PC' %}
        {% include 'formsaurus/templates/picture_choice.html' %}
    {% elif question.type == 'YN' %}
        {% include 'formsaurus/templates/yes_no.html' %}
    {% elif question.type == 'E_' %}
        {% include 'formsaurus/templates/email.html' %}
    {% elif question.type == 'OS' %}
        {% include 'formsaurus/templates/opinion_scale.html' %}
    {% elif question.type == 'R_' %}
        {% include 'formsaurus/templates/rating.html' %}
    {% elif question.type == 'D_' %}
        {% include 'formsaurus/templates/date.html' %}
    {% elif question.type == 'N_' %}
        {% include 'formsaurus/templates/number.html' %}
    {% elif question.type == 'DD' %}
        {% include 'formsaurus/templates/dropdown.html' %}
    {% elif question.type == 'L_' %}
        {% include 'formsaurus/templates/legal.html' %}
    {% elif question.type == 'W_' %}
        {% include 'formsaurus/templates/website.html' %}
    {% elif question.type == 'FU' %}
        {% include 'formsaurus/templates/file_upload.html' %}
    {% endif %}
{% endblock %}

{% block javascript %}
<script>
function readFile(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();

    reader.onload = function(e) {
        console.log(e.target)
        console.log(input.files[0])
        var preview = $('<div>')
        if (input.files[0].type.startsWith('image')) {
            $('<img width="200" src="' + e.target.result + '" />').appendTo(preview)
                
        } else {
            $('<i class="far fa-file"></i>').appendTo(preview)
        }
        $('<p>' + input.files[0].name + '</p>').appendTo(preview)
        $('<a>').attr('href', '#').text('Clear').appendTo(preview).click(function(evt) {
            evt.preventDefault()
            $('#question-form')[0].reset()
            $('.preview-zone').empty().addClass('d-none')
            $('.dropzone-wrapper').removeClass('d-none')
        })
        $('.preview-zone').removeClass('d-none').append(preview)
        $('.dropzone-wrapper').addClass('d-none')
    };

    reader.readAsDataURL(input.files[0]);
  }
}

$(function() {
    form = $('#question-form')
    // Grow textarea dynamically
    form.find('textarea').keyup(function() {
        this.style.height = '1px';
        this.style.height = (this.scrollHeight)+"px";
    })

    // Use Pikaday for input[type="date"]
    date = $('.datepicker')
    if (date.length > 0) {
        date = date[0]
        format = $(date).attr('data-format')
        new Pikaday({
                field: date,
                format: format,
                onSelect: function() {
                    console.log(this.getMoment().format(format));
                }   
            });
    }
    // Use select2 for dropdown
    $('.dropdown').select2({
        allowClear: true,
        placeholder: 'Select an option',
    });
    // Drag & Drop for file upload
    $('.dropzone').change(function() {
        readFile(this)
    });

    $('.dropzone-wrapper').on('dragover', function(e) {
        e.preventDefault()
        e.stopPropagation()
        $(this).addClass('dragover')
    });

    $('.dropzone-wrapper').on('dragleave', function(e) {
        e.preventDefault()
        e.stopPropagation()
        $(this).removeClass('dragover')
    });

});
</script>

{% endblock %}